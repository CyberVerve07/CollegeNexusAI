{
  "entities": {
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course of study offered by the college (e.g., BCA, BBA, BCom, BA).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the course (e.g., BCA, BBA)."
        },
        "description": {
          "type": "string",
          "description": "A description of the course."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Represents a batch or year within a course (e.g., 1st year, 2nd year).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Batch)"
        },
        "year": {
          "type": "number",
          "description": "The year of the batch (e.g., 1, 2, 3)."
        }
      },
      "required": [
        "id",
        "courseId",
        "year"
      ]
    },
    "Semester": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Semester",
      "type": "object",
      "description": "Represents a semester within a batch.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Semester entity."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. (Relationship: Batch 1:N Semester)"
        },
        "semesterNumber": {
          "type": "number",
          "description": "The semester number (e.g., 1, 2, 3, 4, 5, 6)."
        }
      },
      "required": [
        "id",
        "batchId",
        "semesterNumber"
      ]
    },
    "Section": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Section",
      "type": "object",
      "description": "Represents a section within a semester.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Section entity."
        },
        "semesterId": {
          "type": "string",
          "description": "Reference to Semester. (Relationship: Semester 1:N Section)"
        },
        "name": {
          "type": "string",
          "description": "The name of the section (e.g., A, B, C)."
        }
      },
      "required": [
        "id",
        "semesterId",
        "name"
      ]
    },
    "Subject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subject",
      "type": "object",
      "description": "Represents a subject within a semester.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subject entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the subject."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Subject)"
        },
        "semesterId": {
          "type": "string",
          "description": "Reference to Semester. (Relationship: Semester 1:N Subject)"
        },
        "description": {
          "type": "string",
          "description": "A description of the subject."
        }
      },
      "required": [
        "id",
        "name",
        "courseId",
        "semesterId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application (Admin, Teacher, or Student).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., ADMIN, TEACHER, STUDENT)."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "role",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student user, extending the User entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity. Inherited from User."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Student)"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N Student)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to Batch. (Relationship: Batch 1:N Student)"
        },
        "semesterId": {
          "type": "string",
          "description": "Reference to Semester. (Relationship: Semester 1:N Student)"
        },
        "sectionId": {
          "type": "string",
          "description": "Reference to Section. (Relationship: Section 1:N Student)"
        }
      },
      "required": [
        "id",
        "userId",
        "courseId",
        "batchId",
        "semesterId",
        "sectionId"
      ]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher user, extending the User entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Teacher entity. Inherited from User."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Teacher)"
        }
      },
      "required": [
        "id",
        "userId"
      ]
    },
    "Attendance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance",
      "type": "object",
      "description": "Represents a student's attendance record for a specific subject and date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Attendance entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Attendance)"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to Subject. (Relationship: Subject 1:N Attendance)"
        },
        "date": {
          "type": "string",
          "description": "The date of the attendance record.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The attendance status (e.g., PRESENT, ABSENT, LATE)."
        }
      },
      "required": [
        "id",
        "studentId",
        "subjectId",
        "date",
        "status"
      ]
    },
    "StudyMaterial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudyMaterial",
      "type": "object",
      "description": "Represents a study material uploaded for a specific subject.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StudyMaterial entity."
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to Subject. (Relationship: Subject 1:N StudyMaterial)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N StudyMaterial)"
        },
        "title": {
          "type": "string",
          "description": "The title of the study material."
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL or path to the study material file.",
          "format": "uri"
        },
        "uploadDate": {
          "type": "string",
          "description": "The date when the study material was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "subjectId",
        "teacherId",
        "title",
        "fileUrl",
        "uploadDate"
      ]
    },
    "QuestionPaper": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuestionPaper",
      "type": "object",
      "description": "Represents a previous year question paper.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QuestionPaper entity."
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Relationship: Course 1:N QuestionPaper)"
        },
        "semesterId": {
          "type": "string",
          "description": "Reference to Semester. (Relationship: Semester 1:N QuestionPaper)"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to Subject. (Relationship: Subject 1:N QuestionPaper)"
        },
        "examType": {
          "type": "string",
          "description": "The type of exam (e.g., Midterm, End Sem, Internal)."
        },
        "year": {
          "type": "number",
          "description": "The year of the question paper."
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL or path to the question paper file.",
          "format": "uri"
        },
        "uploaderId": {
          "type": "string",
          "description": "Reference to User who uploaded the paper. (Relationship: User 1:N QuestionPaper)"
        }
      },
      "required": [
        "id",
        "courseId",
        "semesterId",
        "subjectId",
        "examType",
        "year",
        "fileUrl",
        "uploaderId"
      ]
    },
    "Notice": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notice",
      "type": "object",
      "description": "Represents a global or class-wise notice.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Notice entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the notice."
        },
        "content": {
          "type": "string",
          "description": "The content of the notice."
        },
        "date": {
          "type": "string",
          "description": "The date when the notice was created.",
          "format": "date-time"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to Course. (Optional, for class-wise notices. Relationship: Course 1:N Notice)"
        },
        "semesterId": {
          "type": "string",
          "description": "Reference to Semester. (Optional, for class-wise notices. Relationship: Semester 1:N Notice)"
        },
        "sectionId": {
          "type": "string",
          "description": "Reference to Section. (Optional, for class-wise notices. Relationship: Section 1:N Notice)"
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "date"
      ]
    },
    "TeacherSubject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TeacherSubject",
      "type": "object",
      "description": "Represents the subjects assigned to a teacher.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TeacherSubject entity."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N TeacherSubject)"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to Subject. (Relationship: Subject 1:N TeacherSubject)"
        },
        "sectionId": {
          "type": "string",
          "description": "Reference to Section. (Relationship: Section 1:N TeacherSubject)"
        }
      },
      "required": [
        "id",
        "teacherId",
        "subjectId",
        "sectionId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information (e.g., BCA, BBA).",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/batches/{batchId}",
        "definition": {
          "entityName": "Batch",
          "schema": {
            "$ref": "#/backend/entities/Batch"
          },
          "description": "Stores batch information for each course.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            },
            {
              "name": "batchId",
              "description": "Unique identifier for the batch."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/batches/{batchId}/semesters/{semesterId}",
        "definition": {
          "entityName": "Semester",
          "schema": {
            "$ref": "#/backend/entities/Semester"
          },
          "description": "Stores semester information for each batch.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            },
            {
              "name": "batchId",
              "description": "Unique identifier for the batch."
            },
            {
              "name": "semesterId",
              "description": "Unique identifier for the semester."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/batches/{batchId}/semesters/{semesterId}/sections/{sectionId}",
        "definition": {
          "entityName": "Section",
          "schema": {
            "$ref": "#/backend/entities/Section"
          },
          "description": "Stores section information for each semester.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            },
            {
              "name": "batchId",
              "description": "Unique identifier for the batch."
            },
            {
              "name": "semesterId",
              "description": "Unique identifier for the semester."
            },
            {
              "name": "sectionId",
              "description": "Unique identifier for the section."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/subjects/{subjectId}",
        "definition": {
          "entityName": "Subject",
          "schema": {
            "$ref": "#/backend/entities/Subject"
          },
          "description": "Stores subject information for each course.",
          "params": [
            {
              "name": "courseId",
              "description": "Unique identifier for the course."
            },
            {
              "name": "subjectId",
              "description": "Unique identifier for the subject."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information (Admin, Teacher, Student).",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student-specific data, including course, batch, semester, and section information. This data is denormalized for authorization independence.",
          "params": [
            {
              "name": "studentId",
              "description": "Unique identifier for the student."
            }
          ]
        }
      },
      {
        "path": "/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores teacher-specific data.",
          "params": [
            {
              "name": "teacherId",
              "description": "Unique identifier for the teacher."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}/attendance/{attendanceId}",
        "definition": {
          "entityName": "Attendance",
          "schema": {
            "$ref": "#/backend/entities/Attendance"
          },
          "description": "Stores attendance records for each student.",
          "params": [
            {
              "name": "studentId",
              "description": "Unique identifier for the student."
            },
            {
              "name": "attendanceId",
              "description": "Unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/subjects/{subjectId}/study_materials/{studyMaterialId}",
        "definition": {
          "entityName": "StudyMaterial",
          "schema": {
            "$ref": "#/backend/entities/StudyMaterial"
          },
          "description": "Stores study materials for each subject. Includes the teacherId for access control.",
          "params": [
            {
              "name": "subjectId",
              "description": "Unique identifier for the subject."
            },
            {
              "name": "studyMaterialId",
              "description": "Unique identifier for the study material."
            }
          ]
        }
      },
      {
        "path": "/question_papers/{questionPaperId}",
        "definition": {
          "entityName": "QuestionPaper",
          "schema": {
            "$ref": "#/backend/entities/QuestionPaper"
          },
          "description": "Stores question papers, accessible based on course, semester, subject, and year.  Includes the uploaderId for tracking.",
          "params": [
            {
              "name": "questionPaperId",
              "description": "Unique identifier for the question paper."
            }
          ]
        }
      },
      {
        "path": "/notices/{noticeId}",
        "definition": {
          "entityName": "Notice",
          "schema": {
            "$ref": "#/backend/entities/Notice"
          },
          "description": "Stores global or class-wise notices. Class-wise notices include courseId, semesterId, and sectionId.",
          "params": [
            {
              "name": "noticeId",
              "description": "Unique identifier for the notice."
            }
          ]
        }
      },
      {
        "path": "/teacher_subjects/{teacherSubjectId}",
        "definition": {
          "entityName": "TeacherSubject",
          "schema": {
            "$ref": "#/backend/entities/TeacherSubject"
          },
          "description": "Stores the subjects assigned to a teacher.",
          "params": [
            {
              "name": "teacherSubjectId",
              "description": "Unique identifier for the teacher subject assignment."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "RoleAdmin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Document existence indicates the user is an administrator. Content is irrelevant.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the admin user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the CollegeMate AI application's requirements for role-based access, attendance management, study materials, question papers, and AI chatbot integration.  The structure prioritizes authorization independence and simplifies security rules. Each collection is designed with a homogeneous security posture, ensuring all documents within a collection share the same security requirements.\n\nAuthorization Independence is achieved through denormalization.  For instance, student information (course, batch, semester, section) is directly embedded within the `students` collection even though references exist at higher levels. This eliminates the need for `get()` calls to parent documents in security rules, allowing atomic operations and simplifying debugging.\n\nThe design also considers the need for secure `list` operations (QAPs).  The segregation of user data (admins, teachers, students) into distinct collections, along with path-based ownership for user-specific data, ensures that listing operations can be secured without complex filtering rules. The use of subcollections for entities related to a user or other entity (e.g., attendance records under student) maintains a clear hierarchy and simplifies access control.  Global roles are managed using dedicated collections like `/roles_admin/{uid}`, leveraging existence checks for efficient role-based authorization."
  }
}